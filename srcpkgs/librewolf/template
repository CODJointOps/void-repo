# Template file for 'librewolf'
pkgname=librewolf
version=148.0
revision=1
_rev=1
archs="x86_64 aarch64"
hostmakedepends="tar xz"
depends="desktop-file-utils hicolor-icon-theme pciutils"
short_desc="LibreWolf web browser (prebuilt binary)"
maintainer="rich <rich@bandaholics.cash>"
license="MPL-2.0"
homepage="https://librewolf.net/"
changelog="https://codeberg.org/librewolf/bsys6/releases"

_tag="${version}-${_rev}"

case "${XBPS_TARGET_MACHINE}" in
x86_64)
	_upstream_arch=x86_64
	_checksum=515f6568a980bf269f3575dc086ac4af9d5d9723b50da577887272f7cd4e47d3
	;;
aarch64)
	_upstream_arch=arm64
	_checksum=11914d72c842771df18dedff4565c95587f7205c5e3576d94a85a3a108686bb2
	;;
*)
	broken="No distfiles available for ${XBPS_TARGET_MACHINE}"
	;;
esac

distfiles="https://codeberg.org/api/packages/librewolf/generic/librewolf/${_tag}/librewolf-${_tag}-linux-${_upstream_arch}-package.tar.xz"
checksum="${_checksum}"
wrksrc=librewolf

nostrip=yes

do_install() {
	install -dm755 \
		"${DESTDIR}/opt/${pkgname}" \
		"${DESTDIR}/usr/bin" \
		"${DESTDIR}/usr/share/applications" \
		"${DESTDIR}/usr/share/pixmaps"

	vcopy * "opt/${pkgname}"
	vinstall "${FILESDIR}/librewolf.desktop" 644 usr/share/applications/

	ln -sf "/opt/${pkgname}/librewolf" "${DESTDIR}/usr/bin/librewolf"
	ln -sf "/opt/${pkgname}/librewolf" "${DESTDIR}/usr/bin/librewolf-wayland"

	vinstall browser/chrome/icons/default/default48.png 644 usr/share/pixmaps librewolf.png
	for size in 16 32 48 64 128; do
		install -dm755 "${DESTDIR}/usr/share/icons/hicolor/${size}x${size}/apps"
		vinstall "browser/chrome/icons/default/default${size}.png" 644 \
			"usr/share/icons/hicolor/${size}x${size}/apps" librewolf.png
	done

	ln -Ts /usr/share/hunspell "${DESTDIR}/opt/${pkgname}/dictionaries"
	ln -Ts /usr/share/hyphen "${DESTDIR}/opt/${pkgname}/hyphenation"
	ln -sf /usr/lib/libnssckbi.so "${DESTDIR}/opt/${pkgname}/libnssckbi.so"
}
