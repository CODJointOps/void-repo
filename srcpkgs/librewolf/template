# Template file for 'librewolf'
pkgname=librewolf
version=147.0.4
revision=2
_rev=1
archs="x86_64 aarch64"
hostmakedepends="tar xz"
depends="desktop-file-utils hicolor-icon-theme pciutils"
short_desc="LibreWolf web browser (prebuilt binary)"
maintainer="rich <rich@bandaholics.cash>"
license="MPL-2.0"
homepage="https://librewolf.net/"
changelog="https://codeberg.org/librewolf/bsys6/releases"

_tag="${version}-${_rev}"

case "${XBPS_TARGET_MACHINE}" in
x86_64)
	_upstream_arch=x86_64
	_checksum=cea5aaf0581d48b5806a85af9829c873d1654e642d70280ba0af57b97b164b83
	;;
aarch64)
	_upstream_arch=arm64
	_checksum=4a2799dd1d2daab54ba710a55848b39e33e4d584bfdfb30768960717f53202f9
	;;
*)
	broken="No distfiles available for ${XBPS_TARGET_MACHINE}"
	;;
esac

distfiles="https://codeberg.org/api/packages/librewolf/generic/librewolf/${_tag}/librewolf-${_tag}-linux-${_upstream_arch}-package.tar.xz"
checksum="${_checksum}"
wrksrc=librewolf

nostrip=yes

do_install() {
	install -dm755 \
		"${DESTDIR}/opt/${pkgname}" \
		"${DESTDIR}/usr/bin" \
		"${DESTDIR}/usr/share/applications" \
		"${DESTDIR}/usr/share/pixmaps"

	vcopy * "opt/${pkgname}"
	vinstall "${FILESDIR}/librewolf.desktop" 644 usr/share/applications/

	ln -sf "/opt/${pkgname}/librewolf" "${DESTDIR}/usr/bin/librewolf"
	ln -sf "/opt/${pkgname}/librewolf" "${DESTDIR}/usr/bin/librewolf-wayland"

	vinstall browser/chrome/icons/default/default48.png 644 usr/share/pixmaps librewolf.png
	for size in 16 32 48 64 128; do
		install -dm755 "${DESTDIR}/usr/share/icons/hicolor/${size}x${size}/apps"
		vinstall "browser/chrome/icons/default/default${size}.png" 644 \
			"usr/share/icons/hicolor/${size}x${size}/apps" librewolf.png
	done

	ln -Ts /usr/share/hunspell "${DESTDIR}/opt/${pkgname}/dictionaries"
	ln -Ts /usr/share/hyphen "${DESTDIR}/opt/${pkgname}/hyphenation"
	ln -sf /usr/lib/libnssckbi.so "${DESTDIR}/opt/${pkgname}/libnssckbi.so"
}
