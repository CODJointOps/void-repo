pkgname=bitwarden
version=2026.1.0
revision=1
archs="x86_64"
short_desc="Bitwarden desktop password manager"
maintainer="rich@bandaholics.cash"
license="GPL-3.0-or-later"
homepage="https://bitwarden.com"

distfiles="https://github.com/bitwarden/clients/releases/download/desktop-v${version}/Bitwarden-${version}-amd64.deb"
checksum=6db36b2ed691901483a1c2355bdef5ca102a1f53a26cf4be2173b9e1a4b252e5

hostmakedepends="tar xz"
depends="gtk+3 nss alsa-lib libnotify libXScrnSaver dbus-glib"

do_extract() {
    ar x ${XBPS_SRCDISTDIR}/${pkgname}-${version}/Bitwarden-${version}-amd64.deb
    tar xf data.tar.xz -C ${wrksrc}
}

do_install() {
    vmkdir /usr/bin
    vmkdir /usr/share/icons/hicolor
    vmkdir /usr/share/applications
    vmkdir /usr/share/doc/bitwarden

    vcopy usr/share/icons/hicolor/* /usr/share/icons/hicolor/
    vcopy usr/share/applications/* /usr/share/applications/
    vcopy usr/share/doc/bitwarden/* /usr/share/doc/bitwarden/

    mkdir -p ${PKGDESTDIR}/opt/Bitwarden
    cp -a ${wrksrc}/opt/Bitwarden/* ${PKGDESTDIR}/opt/Bitwarden/

    ln -sf /opt/Bitwarden/bitwarden ${PKGDESTDIR}/usr/bin/bitwarden

    chmod 4755 ${PKGDESTDIR}/opt/Bitwarden/chrome-sandbox

    vlicense opt/Bitwarden/LICENSE.electron.txt
    vlicense opt/Bitwarden/LICENSES.chromium.html
}